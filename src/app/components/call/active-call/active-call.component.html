<!-- src/app/components/call/active-call/active-call.component.html -->

<div class="active-call-container" (mousemove)="onMouseMove()">
  
  <!-- Remote Video/Avatar (Main) -->
  <div class="remote-video-container">
    <video #remoteVideo 
           *ngIf="isVideoCall() && !remoteIsVideoOff"
           autoplay 
           playsinline
           class="remote-video"></video>
    
    <div *ngIf="!isVideoCall() || remoteIsVideoOff" class="video-placeholder">
      <div class="avatar-large">
        <img *ngIf="remoteParticipant.photoUrl" 
             [src]="remoteParticipant.photoUrl" 
             alt="avatar">
        <span *ngIf="!remoteParticipant.photoUrl">
          {{ getInitials(remoteParticipant.displayName) }}
        </span>
      </div>
    </div>

    <!-- Remote participant status indicators -->
    <div class="remote-status" *ngIf="remoteIsMuted || remoteIsVideoOff || remoteIsScreenSharing">
      <span class="status-badge" *ngIf="remoteIsMuted">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 1a3 3 0 00-3 3v8a3 3 0 006 0V4a3 3 0 00-3-3zm0 16c-3.866 0-7-3.134-7-7h2c0 2.761 2.239 5 5 5s5-2.239 5-5h2c0 3.866-3.134 7-7 7zm-1 2v3h2v-3h-2z"/>
          <line x1="3" y1="3" x2="21" y2="21" stroke="currentColor" stroke-width="2"/>
        </svg>
      </span>
      <span class="status-badge" *ngIf="remoteIsScreenSharing">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M21 3H3c-1.1 0-2 .9-2 2v11c0 1.1.9 2 2 2h6l-2 2v1h10v-1l-2-2h6c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 13H3V5h18v11z"/>
        </svg>
      </span>
    </div>
  </div>

  <!-- Local Video (Picture-in-Picture) -->
  <div class="local-video-container" *ngIf="isVideoCall()">
    <video #localVideo 
           *ngIf="!isVideoOff"
           autoplay 
           muted 
           playsinline
           class="local-video"></video>
    
    <div *ngIf="isVideoOff" class="video-placeholder-small">
      <div class="avatar-small">
        <img *ngIf="localParticipant.photoUrl" 
             [src]="localParticipant.photoUrl" 
             alt="avatar">
        <span *ngIf="!localParticipant.photoUrl">
          {{ getInitials(localParticipant.displayName) }}
        </span>
      </div>
    </div>

    <!-- Local muted indicator -->
    <div class="local-muted-badge" *ngIf="isMuted">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 1a3 3 0 00-3 3v8a3 3 0 006 0V4a3 3 0 00-3-3zm0 16c-3.866 0-7-3.134-7-7h2c0 2.761 2.239 5 5 5s5-2.239 5-5h2c0 3.866-3.134 7-7 7zm-1 2v3h2v-3h-2z"/>
        <line x1="3" y1="3" x2="21" y2="21" stroke="currentColor" stroke-width="2"/>
      </svg>
    </div>
  </div>

  <!-- Call Info Header -->
  <div class="call-header" [class.show]="showControls">
    <div class="call-info">
      <h3 class="participant-name">{{ remoteParticipant.displayName }}</h3>
      <div class="call-stats">
        <span class="call-duration">{{ callDuration }}</span>
        <span class="connection-indicator" [class]="connectionQuality">
          <span class="dot"></span>
          {{ connectionQuality }}
        </span>
      </div>
    </div>
  </div>

  <!-- Call Controls -->
  <div class="call-controls" [class.show]="showControls">
    <div class="controls-wrapper">
      
      <!-- Mute/Unmute -->
      <button class="control-btn" 
              [class.active]="isMuted"
              (click)="onToggleAudio()"
              [title]="isMuted ? 'Unmute' : 'Mute'">
        <svg *ngIf="!isMuted" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 1a3 3 0 00-3 3v8a3 3 0 006 0V4a3 3 0 00-3-3z"/>
          <path d="M19 10v2a7 7 0 01-14 0v-2h2v2a5 5 0 0010 0v-2h2z"/>
          <path d="M11 19v3h2v-3h-2z"/>
        </svg>
        <svg *ngIf="isMuted" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 1a3 3 0 00-3 3v8a3 3 0 006 0V4a3 3 0 00-3-3z"/>
          <path d="M19 10v2a7 7 0 01-14 0v-2h2v2a5 5 0 0010 0v-2h2z"/>
          <line x1="3" y1="3" x2="21" y2="21" stroke="currentColor" stroke-width="2"/>
        </svg>
        <span>{{ isMuted ? 'Unmute' : 'Mute' }}</span>
      </button>

      <!-- Video On/Off -->
      <button *ngIf="isVideoCall()" 
              class="control-btn" 
              [class.active]="isVideoOff"
              (click)="onToggleVideo()"
              [title]="isVideoOff ? 'Turn on camera' : 'Turn off camera'">
        <svg *ngIf="!isVideoOff" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M23 7l-7 5 7 5V7zM2 5h14v14H2V5z"/>
        </svg>
        <svg *ngIf="isVideoOff" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M23 7l-7 5 7 5V7zM2 5h14v14H2V5z"/>
          <line x1="3" y1="3" x2="21" y2="21" stroke="currentColor" stroke-width="2"/>
        </svg>
        <span>{{ isVideoOff ? 'Camera Off' : 'Camera On' }}</span>
      </button>

      <!-- Screen Share -->
      <button *ngIf="isVideoCall()" 
              class="control-btn" 
              [class.active]="isScreenSharing"
              (click)="onToggleScreenShare()"
              [title]="isScreenSharing ? 'Stop sharing' : 'Share screen'">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M21 3H3c-1.1 0-2 .9-2 2v11c0 1.1.9 2 2 2h6l-2 2v1h10v-1l-2-2h6c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 13H3V5h18v11z"/>
          <path *ngIf="isScreenSharing" d="M7 14l5-5 5 5H7z"/>
        </svg>
        <span>{{ isScreenSharing ? 'Stop Share' : 'Share' }}</span>
      </button>

      <!-- End Call -->
      <button class="control-btn end-call-btn" 
              (click)="onEndCall()"
              title="End call">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
          <path d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z"/>
        </svg>
        <span>End Call</span>
      </button>

    </div>
  </div>

</div>